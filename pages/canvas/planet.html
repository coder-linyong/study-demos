<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>星球体</title>
  <style>

      canvas {
          background: #000;
          display: block;
      }
  </style>
</head>
<body>
<canvas width="700" height="700"></canvas>
</body>
<script>
  (function () {
    function randomFloat(min, max) {
      return Math.random() * (max - min) + min
    }

    function randomInt(min, max) {
      return ~~(Math.random() * (max - min + 1) + min)
    }

    /*
      绘制杂乱无序的线
      每次绘制线都逐步增长（不超过画布半径）,色调逐渐增加
      线条设置透明度
      线条交叠部分取亮的色值
    */
    class Radiation {
      #points = []

      constructor(x, y) {
        this.hub = 250
        this.life = 1
        this.decay = 0.000001
        this.offset = 1
        this.x = x
        this.y = y
        this.pointNum = 70
        this.angle = 0
      }

      #generatePoints() {
        const poiArr = this.#points = [],
          {
            x,
            pointNum,
            offset,
            y
          } = this
        let i = 0
        do {
          this.angle += randomFloat(-Math.PI, Math.PI)
          poiArr.push({
            x: x + Math.cos(this.angle) * offset,
            y: y + Math.sin(this.angle) * offset
          })
          i++
        } while (i < pointNum)
        this.offset+=0.5
        this.pointNum += randomInt(pointNum * 0.006, pointNum * 0.010)
      }

      draw(ctx) {
        const {
          pointNum,
          decay,
          hub
        } = this
        this.#generatePoints()
        const points = this.#points
        for (let i = 0; i < pointNum; i++) {
          const lastPoint = points[randomInt(0, pointNum - 1)],
            point = points[i]
          ctx.beginPath()
          ctx.moveTo(point.x, point.y)
          ctx.lineTo(lastPoint.x, lastPoint.y)
          ctx.strokeStyle = `hsl(${hub + randomInt(-10, 10)}, ${randomInt(50, 70)}%,${randomInt(50, 70)}%,${this.life * 0.1})`
          ctx.stroke()
          this.life -= decay
        }
      }
    }

    const canvas = document.querySelector('canvas')
    if (!canvas?.getContext ?? true) return
    const ctx = canvas.getContext('2d'),
      radiation = new Radiation(canvas.width / 2, canvas.height / 2)
    ctx.globalAlpha = 0.021
    ctx.globalCompositeOperation = 'lighter'

    function render() {
      radiation.draw(ctx)
      if (radiation.life > 0) requestAnimationFrame(render)
    }

    render()
  })()
</script>
</html>
